################################################################################
# Stack: beszel
# Descricao: Monitoramento leve de recursos do host e containers (Hub + Agent)
# Autor: Gemini - Aiknow Systems
# Data: 2026-01-19
# Versao: 1.0
# Acesso: http://localhost:8090
################################################################################

x-common: &common
  restart: unless-stopped
  networks:
    - llmserver
  logging:
    driver: "json-file"
    options:
      max-size: "10m"
      max-file: "3"
  security_opt:
    - no-new-privileges:true

services:
  beszel-hub:
    image: "henrygd/beszel:latest"
    container_name: beszel-hub
    <<: *common
    ports:
      - "\${BESZEL_PORT:-8090}:8090"
    volumes:
      - beszel_data:/beszel_data
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8090"]
      interval: 10s
      timeout: 5s
      retries: 3

  beszel-agent:
    image: "henrygd/beszel-agent:latest"
    container_name: beszel-agent
    restart: unless-stopped
    networks:
      - llmserver
    ports:
      - "45876:45876"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      PORT: 45876
      # KEY: "\${BESZEL_AGENT_KEY}" # Sera configurada via .env apos o primeiro acesso ao Hub

networks:
  llmserver:
    external: true

volumes:
  beszel_data:
